---
title: "Introduction to reporttoolDT"
author: "Kristian D. Olsen"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Foreword

This package is meant for a particular use, which is to work with data from surveys to generate batch reports. To do so, we need to keep track of the labels (questions) for each variable, in addition to latent associations for use in structural modelling (PLS-PM).

To achieve this, `reporttool` provides a `Survey` class which is built using R6, and stuffs some extra information into private (hidden) `fields` inside it. For users, a `Survey` should look and behave pretty much like a normal `data.frame`, `data.table` or `tbl` (dplyr). Internally `Survey`'s helps us keep track of the hidden fields, toward the end goal of automating tables, plots and reports.

*Note* that `reporttoolDT` is meant to be used with `R6Frame`, `seamless` and `tabulR`. These packages are loaded automatically when you call `library(reporttoolDT)`.

## Usage

For these examples, we'll start with some "raw data" from SPSS and go through the steps necessary to create tables, plots and reports. I recommend using `reporttoolDT` with [dplyr](https://github.com/hadley/dplyr):


#### Read and prepare

```{r, warning = FALSE, message = FALSE}
require(dplyr)
require(reporttoolDT)

sav <- read_data(system.file("extdata", "raw_data.sav", package = "reporttoolDT"))
srv <- survey_tbl(sav) %>%
  set_association(common = TRUE) %>%
  set_config(name = "Example", segment = "B2C", cutoff = .3) %>%
  set_marketshare(CompanyA = .3, CompanyB = .5, CompanyC = .2) %>%
  set_translation(language = "english") %>%
  latents_mean() 
```

For more information about the steps above, check out the [vignette](https://github.com/itsdalmo/reporttoolDT/blob/master/vignettes/prepare.Rmd) by running `vignette("workflow", package = "reporttoolDT")`. We are now ready to generate output from the `Survey`.

#### Tables

To generate tables, we can use the `qtable()` function from the tabulR package.

```{r, warning = FALSE, message = FALSE}
srv %>% group_by(q1) %>% qtable(q17)
```

We can also use `latent_table()` and `manifest_table()` to easily summarise the model variables:

```{r, warning = FALSE, message = FALSE}
srv %>% group_by(q1) %>% latent_table()
```

#### Recode

Let's say we wanted to recode "had reason to complain" as "no", and create a table of satisfaction for complaining and non-complaining customers (by company), we can call:

```{r, warning = FALSE, message = FALSE}
srv %>% 
  mutate(q17 = recode(q17, Nei = c("Nei", "Hadde grunn til Ã¥ klage, men klaget ikke"))) %>%
  group_by(q1, q17) %>%
  qtable(epsi)
```

#### Charts

Creating charts works more or less exactly like `qtable()`, except we have two choices - `bar_chart()` and `line_chart()`:

```{r, warning = FALSE, message = FALSE}
srv %>% group_by(q1) %>% bar_chart(epsi, margin = FALSE)
```

We can also use `manifest_plot()` and `latent_plot()` to visualize our model variables:

```{r, warning = FALSE, message = FALSE}
srv %>% group_by(q1) %>% latent_plot()
```

The plots are meant as a baseline, and can be further adjusted using ggplot2 (which was also used to create them).

#### Output

To create PDF or Powerpoint output, we first create a workbook in R, and use `to_ppt` and `to_excel` to send tables and/or plots to the workbook. The workbook can then be saved with `write_data` after. Let's start with Excel:

```{r, warning = FALSE, message = FALSE}
wb <- excel_workbook()

# Add the latent table
srv %>% group_by(q1) %>% latent_table() %>% to_excel(wb)

# Add manifest table
srv %>% group_by(q1) %>% manifest_table() %>% to_excel(wb)

# Save
# write_data(wb, "reporttool example.xlsx")
```

We cannot send plots to Excel, but we can with Powerpoint:

```{r, warning = FALSE, message = FALSE}
if (require(ReporteRs)) {
   wb <- ppt_workbook()

  # Add the latent plot
  srv %>% group_by(q1) %>% latent_plot() %>% to_ppt(wb, title = "Latent plot")

  # And also satisfaction barchart
  srv %>% group_by(q1) %>% bar_chart(epsi, margin = FALSE) %>% to_ppt(wb, title = "Satisfaction")

  # Save
  # write_data(wb, "reporttool example.pptx") 
}
```

#### Reports

Coming soon.

## More information

## More information

[Survey-class](https://github.com/itsdalmo/reporttoolDT/blob/master/vignettes/survey.Rmd): 
```{r, eval = FALSE}
vignette("survey", package = "reporttoolDT")
```

[Preparing data](https://github.com/itsdalmo/reporttoolDT/blob/master/vignettes/prepare.Rmd):
```{r, eval = FALSE}
vignette("prepare", package = "reporttoolDT")
```

[Other functions](https://github.com/itsdalmo/reporttoolDT/blob/master/vignettes/other.Rmd): 
```{r, eval = FALSE}
vignette("other", package = "reporttoolDT")
```
